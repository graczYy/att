<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Аттестация</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0b0f;
      --card:#11131a;
      --muted:#9aa4b2;
      --accent: #7c5cff;
      --accent2:#22d3ee;
      --good:#16a34a;
      --bad:#ef4444;
      --warn:#f59e0b;
      --glass: rgba(255,255,255,0.06);
      --border: rgba(255,255,255,0.08);
    }
    *{box-sizing:border-box}
    html,body{margin:0;padding:0;background:radial-gradient(1200px 1200px at 10% -10%, rgba(124,92,255,.15), transparent 40%),
                                 radial-gradient(1200px 1200px at 90% 10%, rgba(34,211,238,.12), transparent 40%),
                                 linear-gradient(180deg, #0b0b0f 0%, #0b0b0f 60%, #0a0a0c 100%);
      color:#e5e7eb;font-family:'Inter',system-ui,Segoe UI,Roboto,Arial,sans-serif;min-height:100vh}
    .wrap{max-width:1100px;margin:0 auto;padding:32px}
    header{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:20px}
    .title{font-weight:800;letter-spacing:.3px;font-size:24px}
    .nick{display:flex;gap:12px;align-items:center}
    .input{background:var(--glass);border:1px solid var(--border);padding:12px 14px;border-radius:12px;color:#fff;outline:none;min-width:240px}
    .input::placeholder{color:#6b7280}

    /* History */
    .history{background:linear-gradient(180deg, rgba(124,92,255,.08), rgba(34,211,238,.05));border:1px solid var(--border);border-radius:16px;padding:18px 18px 6px;margin:10px 0 22px;box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .history h3{margin:0 0 10px;font-size:16px;color:#cbd5e1}
    .history-list{display:grid;grid-template-columns:repeat(1,1fr);gap:8px}
    .hrow{display:flex;gap:10px;align-items:center;justify-content:space-between;background:rgba(255,255,255,.03);border:1px solid var(--border);padding:10px 12px;border-radius:12px}
    .htag{font-size:12px;color:#9aa4b2}
    .hpass{font-weight:700}

    /* Role banners */
    .roles{display:flex;gap:16px;overflow-x:auto;padding-bottom:8px}
    .role{position:relative;isolation:isolate;min-width:320px;flex:0 0 33%;background:var(--card);border:1px solid var(--border);border-radius:18px;padding:18px;cursor:pointer;transition:transform .25s ease, box-shadow .25s ease}
    .role:hover{transform:translateY(-4px);box-shadow:0 18px 48px rgba(124,92,255,.15)}
    .role h4{margin:0 0 6px;font-size:22px;letter-spacing:.2px}
    .role .meta{display:flex;gap:10px;color:var(--muted);font-size:13px}
    .role .grad{position:absolute;inset:-2px;border-radius:20px;z-index:-1;background:conic-gradient(from 0deg, rgba(124,92,255,.8), rgba(34,211,238,.8), rgba(20,184,166,.8), rgba(124,92,255,.8));filter:blur(28px);opacity:.35;transition:opacity .35s ease}
    .role:hover .grad{opacity:.6}
    .role .chip{display:inline-flex;gap:8px;align-items:center;font-weight:700}
    .chip .ok{color:var(--good)}
    .chip .no{color:var(--bad)}

    /* Test card */
    .card{margin-top:18px;background:var(--card);border:1px solid var(--border);border-radius:16px;padding:24px;box-shadow:0 16px 48px rgba(0,0,0,.35);animation:rise .45s ease}
    @keyframes rise{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}
    .qtext{font-size:20px;margin:8px 0 2px}
    .progress{display:flex;align-items:center;justify-content:space-between;margin-top:8px}
    .bar{position:relative;width:100%;height:10px;background:rgba(255,255,255,.06);border:1px solid var(--border);border-radius:999px;overflow:hidden;margin-right:10px}
    .bar > span{position:absolute;left:0;top:0;bottom:0;width:0;background:linear-gradient(90deg,var(--accent),var(--accent2));transition:width .35s ease}
    .pcount{font-size:12px;color:var(--muted)}

    .actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:14px}
    .btn{padding:12px 16px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.04);color:#fff;cursor:pointer;font-weight:600;transition:transform .15s ease, filter .2s}
    .btn:hover{transform:translateY(-2px)}
    .btn.good{background:rgba(34,197,94,.1)}
    .btn.warn{background:rgba(245,158,11,.1)}
    .btn.bad{background:rgba(239,68,68,.1)}

    /* Result */
    .result{display:none;margin-top:18px;padding:24px;border-radius:16px;border:1px solid var(--border);background:linear-gradient(180deg, rgba(34,197,94,.08), rgba(34,197,94,.04));box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .result.bad{background:linear-gradient(180deg, rgba(239,68,68,.12), rgba(239,68,68,.06))}
    .rhead{display:flex;align-items:center;justify-content:space-between}
    .rgrade{font-size:28px;font-weight:800}
    .rchip{padding:6px 10px;border-radius:999px;border:1px solid var(--border);font-weight:700}
    .rchip.ok{color:#fff;background:rgba(34,197,94,.15)}
    .rchip.no{color:#fff;background:rgba(239,68,68,.15)}
    .rgrid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:12px}
    .rcell{background:rgba(255,255,255,.04);border:1px solid var(--border);padding:12px;border-radius:12px}
    .rlabel{color:var(--muted);font-size:12px}
    .rval{font-weight:700;margin-top:4px}
    .rlog{margin-top:14px}
    .rlog li{margin:6px 0}
    .download{margin-top:10px}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">Аттестации</div>
      <div class="nick">
        <input id="nickname" class="input" placeholder="Ник аттестуемого"/>
      </div>
    </header>

    <!-- История (всегда сверху) -->
    <section class="history">
      <h3>История аттестаций</h3>
      <div id="historyList" class="history-list"></div>
      <div class="download"><button class="btn" id="downloadBtn">Скачать attlist.txt</button></div>
    </section>

    <!-- Выбор роли (горизонтальные баннеры) -->
    <section class="roles" id="roleRow">
      <div class="role" data-role="helper" tabindex="0">
        <div class="grad"></div>
        <h4>ХЕЛПЕР</h4>
        <div class="meta"><span>27 вопросов</span>•<span>~7:45</span></div>
      </div>
      <div class="role" data-role="moderator" tabindex="0">
        <div class="grad"></div>
        <h4>МОДЕРАТОР</h4>
        <div class="meta"><span>57 вопросов</span>•<span>~16:01</span></div>
      </div>
      <div class="role" data-role="admin" tabindex="0">
        <div class="grad"></div>
        <h4>АДМИНИСТРАТОР</h4>
        <div class="meta"><span>25 вопросов</span>•<span>~10:00</span></div>
      </div>
    </section>

    <!-- Карточка теста -->
    <section id="testCard" class="card" style="display:none">
      <div class="progress">
        <div class="bar"><span id="barFill"></span></div>
        <div class="pcount" id="pcount">0/0</div>
      </div>
      <div id="qtext" class="qtext"></div>
      <div class="pcount" id="timer">—</div>
      <div class="actions">
        <button class="btn bad"  id="btnWrong">❌ Неверно</button>
        <button class="btn warn" id="btnPartial">⚠️ Частично</button>
        <button class="btn good" id="btnRight">✅ Верно</button>
        <button class="btn" id="btnNext">Следующий вопрос →</button>
      </div>
    </section>

    <!-- Результат -->
    <section id="result" class="result">
      <div class="rhead">
        <div class="rgrade" id="rGrade">Оценка — 0.00/10</div>
        <div class="rchip" id="rChip">—</div>
      </div>
      <div class="rgrid">
        <div class="rcell"><div class="rlabel">Аттестуемый</div><div class="rval" id="rName">—</div></div>
        <div class="rcell"><div class="rlabel">Роль</div><div class="rval" id="rRole">—</div></div>
        <div class="rcell"><div class="rlabel">Время</div><div class="rval" id="rTime">—</div></div>
      </div>
      <div class="rgrid" style="margin-top:8px">
        <div class="rcell"><div class="rlabel">Правильных</div><div class="rval" id="rOk">—</div></div>
        <div class="rcell"><div class="rlabel">Частично</div><div class="rval" id="rHalf">—</div></div>
        <div class="rcell"><div class="rlabel">Неверных</div><div class="rval" id="rBad">—</div></div>
      </div>
      <div class="rlog">
        <div class="rlabel">Лог неточных ответов</div>
        <ul id="rList"></ul>
      </div>
    </section>
  </div>

  <script>
    // ===== Банк вопросов =====
    const questions = {
      helper: [
        "Назови обязанности Хелпера (слежка за фракцией, репорты)",
        "После захода на рабочий сервер, что нужно сделать перед началом работы? (зайти в дс, отписать о заходе, отсортировать репорты по айди)",
        "Как проводится проверка на АФК? (5 минут, чередуя /b чат и войс)",
        "Как снять пред? А выговор? (14 д +150 реп, 30д +300 реп)",
        "Какой срок хранения видеофиксаций с нарушением игрока? (14 дней)",
        "Ты увидел, что игрок с 5 уровнем нарушил, что ты будешь делать? (предупреждение, если повтор — наказание)",
        "Какой минимальный онлайн в день/месяц? (4, 120)",
        "Что будешь делать если увидишь игрока летающего по карте? (откину в кпз/кикну до прихода старших)",
        "Во сколько падает груз? (12:00, 16:00, 21:30, 00:00)",
        "Можно ли продавать именные номера? (нет)",
        "Как создать семью и какая на нее стоимость? (5кк или 1к доната)",
        "Для чего катализаторы? (+% к прокачке оружия)",
        "Какие есть ветки развития в клане? (байкеры, стритрейсеры, братки-90)",
        "В каких фракциях нет выхода на крышу? (Мэрии)",
        "С какого звания можно писать в Объявление Фракций? (Старшина)",
        "Где можно продать квартиру/дом? (Мэрия, Торговая площадка, Аукцион)",
        "Через стажировку каких фракций нельзя получить военный билет? (Мэрия и МЗ)",
        "Какие кланы участвуют в битве за картель? (топ 10)",
        "С какого ранга доступен сбор МЗДЫ с территорий? (Старший)",
        "С какого ранга можно присоединиться к битве за территории? (Местный)",
        "Сколько здоровья добавляет бафф “Доритос” максимальной прокачки? (25 ед)",
        "Какое наказание за 1 стадию срыва МП? (Кик)",
        "Когда можно использовать голосовую отыгровку? (если 50%+ участников согласны)",
        "Что такое правило новой жизни? (после смерти нельзя продолжать прежний РП-процесс)",
        "Когда можно чинить машины игрокам? (в случае бага, нанесящего урон авто)",
        "Если сотрудник фракции нарушил без формы, отправлять проблемник? (нет)",
        "Тебя ТПшнул модератор на репорт о твоём наказании — будешь объяснять в войс? (нет, в войс нельзя)"
      ],
      moderator: [
        "Назови обязанности модератора? (курирование фракции, выдачи, таски, обучении более младших админов, репорты)",
        "Каким образом ты будешь изменять никнейм игроку? (телепортируюсь, дам время на выбор ника и сменю. Если оскорбительный - сменю принудительно)",
        "Как убрать ограничение на аккаунте, связанное с продажей имущества? (Техподдержка)",
        "Какие скины запрещено выдавать? (Ребенок, животные, нерелиз и красные)",
        "Что выдается за обход блокировки? (бан на срок бана, который игрок обошел)",
        "Что такое Абьюз? (использование ошибок игры с целью получения приемущества)",
        "Назови виды абьюза по правилам проекта (7.1, оружия, ворот, стамины, на клановых/фракционных МП)",
        "Когда игрок простреливает текстуру — это что? (абьюз)",
        "В чём различие IC от OOC? (инфа в характере рп персонажа и вне его характера(ирл))",
        "Какой транспорт нельзя продать на БУ рынке? (воздушный, морской, одноместный, фуры)",
        "Ремонтируется ли колесо рем. комплектом? (нет)",
        "Какие есть виды валют на проекте? (Рейс-коины, next-коины, игровая валюта, донат валюта, клановая валюта, утилизационные коины, биткоины, коины с опасных заданий, реферальные коины, фестивальная)",
        "Какой должен быть уровень оружия, чтобы утилизировать? (2)",
        "Когда проходит аукцион в порту МСК? (Среда и Воскресенье в 18:00)",
        "С какого уровня можно купить широн на бу? (любой)",
        "Какими способами можно изменить соц. рейтинг? (В мз изменить за виртуальную валюту, попросить лайк у другого игрока, в церкви, с помощью готовки или во фраке)",
        "Назови способы получения парашюта на проекте (Останкинская башня, сесть водителем в воздушный транспорт, учение в Армии)",
        "Глобальный — IC или OOC чат? (IC)",
        "Какие виды гонок есть на проекте? (Спринт, дрифт, драг-рейсинг, гоночная битва, уличные гонки)",
        "Где можно потратить биткоины? (Магазин форбс)",
        "Сколько видов лидербордов есть на проекте и какие? (Автопарк, имущество, оружие, достижение)",
        "Как часто обновляются Уникальные предложения? (2 раза в неделю, понедельник и четверг)",
        "Как включить неон на авто? (Tab)",
        "Что ответить игроку по поводу ×2 доната у друга? (Акции рандомны)",
        "Какие виды деталей в тюнинге есть? (X R F)",
        "Назови хобби проекта (Рыбалка, Охота, Клады)",
        "Что ответить игроку, не согласному с наказанием? (Пересмотреть откат, объяснить нарушение словами, вызвать старшего если требуется. В крайнем случае - форум)",
        "Игрок перекрыл дорогу ТС. Что делать? (Выдать пред и убрать машины, при повторе - КПЗ за помеху)",
        "Передача аккаунта — какое наказание? (7д бана)",
        "Читер летит в авто со своим другом. Действия? (передать за покрывательство друга, игрока забанить за ПО)",
        "Что выдается за передачу валюты через казино? (пред, затем пермач)",
        "Как можно нанести ущерб серверу бездействием? (покрывательство)",
        "Игрок говорит “Иди убейся”. За что накажешь? (нет нарушений)",
        "На спавне кричат “Слава Украине”. Действия? (пред, затем наказание за 9.11)",
        "ППС просит паспорт без инвиза. Что делать? (объяснить, что я нрп персонаж и улететь)",
        "Оскорбляют в внеигровом чате. Действия? (6.4)",
        "Оскорбление в названии клана — что делать? (передать зу, изменить)",
        "Репорт: не может передать деньги девушке. Почему? (Техподдержка)",
        "Игрок вышел во время оформления ППС. Что делать? (ничего, система накажет)",
        "Разговариваешь с игроками просто так — последствия? (выговор/снятие)",
        "К тебе в войс заходит стажер Сибирского сервера и говорит 'Можешь по моему нику глянуть, пришел мне донат на аккаунт, или нет? А то лень заходишь' - твои действия? (Объяснить стажеру, что админскую информацию мы не разглашаем и он должен зайти самостоятельно)",
        "Какие команды отыгрываются в голос? (me)",
        "Можно ли наказывать медиа партнёра по 6.16? (Да)",
        "Война кланов — стреляются 2 игрока, вмешался ППС и задержал одного из них. Есть нарушения? (Да, передать за сотрудничество с ОПГ)",
        "Репорт о передаче аккаунта — действия? (Проверить по SP айпишники, если различие более 200км - в таск на зу с указанием времени передачи)",
        "Ты видишь, как твой хелпер телепортирует игроков без репорта, чинит им машины, возраждает. Действия? (Снять/наказать за превышение полномочий)",
        "Максимум замов во фракции МЗ? (7)",
        "Как выйти из ЧС лидеров? (спустя 3 месяца написать на форум)",
        "Когда спутник не отслеживает местоположение? (Интерьер, скрытие ника, ивент)",
        "Жалоба: лидер понизил с сержанта до стажёра. Что делать? (проверить трудовую, если правда - передать куратору лидеров)",
        "Можно ли фракциям использовать статьи из реала? (нет)",
        "Работаешь по репорту, машина инкоссов где сидит игрок и не работает, на него жалуются. Действия? (Проверить на афк, если выяснилось - кик)",
        "Лидер переводит в другой город 3-й раз за день. Что делать? (ничего, имеет право)",
        "Лидер видит чаты всех городов, или только того, где назначен? (Всех)"
      ]
    };

    // ===== Состояние =====
    let role = null, list = [], i = 0, score = 0, half = 0, wrong = 0, startedAt = 0, tickRef = null, nickname = '';

    // ===== UI helpers =====
    const $ = s => document.querySelector(s);
    const el = id => document.getElementById(id);

    function setProgress(){
      const pct = list.length ? ((i)/list.length*100) : 0;
      el('barFill').style.width = pct+'%';
      el('pcount').textContent = `${Math.min(i+1, list.length)}/${list.length}`;
    }

    function renderQuestion(){
      if(i>=list.length){ return endTest(); }
      el('qtext').textContent = list[i];
      setProgress();
    }

    function startRole(r){
      nickname = el('nickname').value.trim();
      if(!nickname){ alert('Введите ник аттестуемого'); return; }
      role = r; list = [...questions[r]]; i=0; score=0; half=0; wrong=0; startedAt=Date.now();
      $('#testCard').style.display='block';
      $('#result').style.display='none';
      renderQuestion();
      tickRef && clearInterval(tickRef);
      tickRef = setInterval(()=>{ const sec = Math.floor((Date.now()-startedAt)/1000); el('timer').textContent = `Прошло: ${sec} сек.`; },1000);
    }

    function grade(val){
      score += val; if(val===0.5) half++; if(val===0) wrong++;
      if(val<1){ // лог неточных
        const li = document.createElement('li');
        li.textContent = `${i+1}. ${list[i]} — ${val===0?'Неверно':'Частично'}`;
        el('rList').appendChild(li);
      }
      i++; renderQuestion();
    }

    function endTest(){
      clearInterval(tickRef);
      $('#testCard').style.display='none';
      const grade10 = +(score / list.length * 10).toFixed(2);
      const passed = grade10 >= 7;
      const seconds = Math.floor((Date.now()-startedAt)/1000);

      const res = $('#result');
      res.classList.toggle('bad', !passed);
      res.style.display='block';
      el('rGrade').textContent = `Оценка — ${grade10}/10`;
      el('rChip').textContent = passed ? 'ПРОЙДЕНО' : 'НЕ ПРОЙДЕНО';
      el('rChip').className = 'rchip ' + (passed ? 'ok' : 'no');
      el('rName').textContent = nickname;
      el('rRole').textContent = roleName(role);
      el('rTime').textContent = fmtTime(seconds) + (isFast(role, seconds) ? ' • быстро' : ' • медленно');
      el('rOk').textContent = (list.length - half - wrong);
      el('rHalf').textContent = half;
      el('rBad').textContent = wrong;

      appendHistory({
        id: Date.now(),
        name: nickname,
        role: roleName(role),
        grade: grade10,
        passed,
        seconds,
        timestamp: new Date().toISOString()
      });
      renderHistory();
    }

    function roleName(r){
      return r==='helper'?'Хелпер': r==='moderator'?'Модератор':'Администратор';
    }

    function fmtTime(s){
      const m = Math.floor(s/60), ss = s%60; return `${m}:${String(ss).padStart(2,'0')}`;
    }

    function isFast(r, s){
      // пороги из ТЗ: helper 7:45 (465с), moder 16:01 (961с). Для admin поставим референс 10:00 (600с)
      const thr = r==='helper'?465 : r==='moderator'?961 : 600;
      return s <= thr;
    }

    // ===== История / attlist =====
    const LS_KEY = 'attlist';

    function loadHistory(){
      try{ return JSON.parse(localStorage.getItem(LS_KEY)||'[]'); }catch(e){return []}
    }
    function saveHistory(arr){ localStorage.setItem(LS_KEY, JSON.stringify(arr)); }

    function appendHistory(entry){
      const arr = loadHistory();
      arr.push(entry);
      saveHistory(arr);
    }

    function renderHistory(){
      const box = el('historyList'); box.innerHTML = '';
      const arr = loadHistory().slice().reverse();
      if(!arr.length){ box.innerHTML = '<div class="htag">История пуста</div>'; return; }
      arr.forEach(e=>{
        const row = document.createElement('div'); row.className='hrow';
        const left = document.createElement('div');
        left.innerHTML = `<div><strong>${e.name}</strong> • ${e.role}</div><div class="htag">${new Date(e.timestamp).toLocaleString()}</div>`;
        const right = document.createElement('div'); right.className='chip';
        const pass = document.createElement('span'); pass.className='hpass'; pass.textContent = `${e.grade}/10`;
        const tag = document.createElement('span'); tag.className = e.passed?'ok':'no'; tag.textContent = e.passed?'пройдено':'не пройдено';
        right.appendChild(pass); right.appendChild(tag);
        row.appendChild(left); row.appendChild(right);
        box.appendChild(row);
      });
    }

    function downloadAttlist(){
      const arr = loadHistory();
      const lines = arr.map((e,idx)=>`${idx+1}. ${e.name} • ${e.role} • ${e.grade}/10 • ${fmtTime(e.seconds)} • ${e.passed?'пройдено':'не пройдено'} • ${new Date(e.timestamp).toLocaleString()}`);
      const blob = new Blob([lines.join('\n')||'История пуста'], {type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='attlist.txt'; a.click(); URL.revokeObjectURL(url);
    }

    // ===== Слушатели =====
    document.querySelectorAll('.role').forEach(card=>{
      card.addEventListener('click',()=>startRole(card.dataset.role));
      card.addEventListener('keydown',e=>{ if(e.key==='Enter' || e.key===' '){ e.preventDefault(); startRole(card.dataset.role);} });
    });

    el('btnWrong').onclick = ()=>grade(0);
    el('btnPartial').onclick = ()=>grade(0.5);
    el('btnRight').onclick = ()=>grade(1);
    el('btnNext').onclick = ()=>{ i++; renderQuestion(); };
    el('downloadBtn').onclick = downloadAttlist;

    // Инициализация
    renderHistory();
  </script>
</body>
</html>
